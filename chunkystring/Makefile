# Makefile for ChunkySting Tester
# 
# As usual, you can build this software by typing
#
#     make
#

# ----- Make Macros -----

CXXFLAGS    =   -g -stdlib=libc++ -std=c++11 -Wall -Wextra -pedantic 
CXX     =   clang++

GTEST_DIR   = gtest
GTEST_OBJS  = gtest-all.o

# Flags passed to the preprocessor.
# We have no idea here whether pthreads is available in the system, so
# disable its use.
CPPFLAGS += -I. -DGTEST_HAS_PTHREAD=0

TARGETS         =   stringtest stringtest-ours
STRINGTEST_OBJS     =   chunkystring.o stringtest.o
STRINGTEST-OURS_OBJS = chunkystring.o stringtest-ours.o
ALL_OBJS        =   $(STRINGTEST_OBJS) $(STRINGTEST-OURS_OBJS)


# ----- Make Rules -----

all:    $(TARGETS)

stringtest: $(STRINGTEST_OBJS) $(GTEST_OBJS)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(STRINGTEST_OBJS) \
		$(LIBS) $(GTEST_OBJS)

stringtest-ours: $(STRINGTEST-OURS_OBJS) $(GTEST_OBJS)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(STRINGTEST-OURS_OBJS) \
		$(LIBS) $(GTEST_OBJS)

test: stringtest stringtest-ours 
	./stringtest
	./stringtest-ours 

clean:
	rm -f $(TARGETS) $(ALL_OBJS)

#
# Google Test Code
#
gtest-all.o : gtest/gtest.h gtest/gtest-all.cc
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c gtest/gtest-all.cc 

# ---- Dependencies (generated by typing ``clang++ -MM *.cpp'') ----

stringtest.o: chunkystring.hpp iterator-private.hpp stringtest.cpp
stringtest-ours.o: chunkystring.hpp iterator-private.hpp stringtest-ours.cpp
chunkystring.o: chunkystring.cpp chunkystring.hpp iterator-private.hpp
